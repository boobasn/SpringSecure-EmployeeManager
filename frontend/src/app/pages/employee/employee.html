<div class="topbar">
  <div *ngIf="notification.show"
      class="notification"
      [ngClass]="notification.type">

    {{ notification.message }}

  </div>
  <div class="left-tools">
    <input
      type="text"
      class="search"
      placeholder="Search employee..."
      [(ngModel)]="search" />

    <select>
      <option>Type</option>
    </select>

    <select>
      <option>Status</option>
    </select>

    <select>
      <option>Role</option>
    </select>

    <button class="filter-btn">
      Advanced Filter
    </button>
  </div>

  <button class="add-btn" (click)="openAddModal()">
    + Add Employee
  </button>

</div>


<!-- =======================
     EMPLOYEE CARDS
======================= -->
<div class="cards">

  <div class="card"
       *ngFor="let emp of employees$ | async">

    <div class="status">
      <span class="active">Active</span>
    </div>

    <img src="https://i.pravatar.cc/100"
         class="avatar">

    <h3>
      {{ emp.firstName }} {{ emp.lastName }}
    </h3>

    <p class="poste">
      {{ emp.poste?.titre || 'Employ√©' }}
    </p>

    <div class="infos">
      <p>üìß {{ emp.email }}</p>
      <p>üìû {{ emp.telephone }}</p>
    </div>

    <div class="detail-actions">

      <button class="icon-btn details-btn"
              (click)="openProfile(emp); $event.stopPropagation()">
        <span class="material-icons">visibility</span>
      </button>

      <button class="icon-btn edit-btn"
              (click)="openEditModal(emp); $event.stopPropagation()">
        <span class="material-icons">edit</span>
      </button>

      <button class="icon-btn delete-btn"
              (click)="deleteEmployee(emp); $event.stopPropagation()">
        <span class="material-icons">delete</span>
      </button>

    </div>

  </div>

</div>


<!-- =======================
     DETAIL OVERLAY
======================= -->
<div class="detail-bg" *ngIf="selectedEmployee as emp">

  <div class="detail-card">

    <div class="detail-header">
      <div class="avatar-wrap">
        <img src="https://i.pravatar.cc/150">
        <h2>
          {{ emp.firstName }} {{ emp.lastName }}
        </h2>
        <p>{{ emp.poste?.titre || 'Employ√©' }}</p>
      </div>

      <button class="close" (click)="closeDetails()">‚úñ</button>
    </div>


    <div class="detail-grid">

      <!-- PRENOM -->
      <div>
        <label>Pr√©nom</label>
        <ng-container *ngIf="isEditMode; else fn">
          <input [(ngModel)]="editEmployeeData.firstName">
        </ng-container>
        <ng-template #fn><p>{{ emp.firstName }}</p></ng-template>
      </div>


      <!-- NOM -->
      <div>
        <label>Nom</label>
        <ng-container *ngIf="isEditMode; else ln">
          <input [(ngModel)]="editEmployeeData.lastName">
        </ng-container>
        <ng-template #ln><p>{{ emp.lastName }}</p></ng-template>
      </div>


      <!-- MATRICULE -->
      <div>
        <label>Matricule</label>
        <ng-container *ngIf="isEditMode; else mat">
          <input [(ngModel)]="editEmployeeData.matricule">
        </ng-container>
        <ng-template #mat><p>{{ emp.matricule }}</p></ng-template>
      </div>


      <!-- EMAIL -->
      <div>
        <label>Email</label>
        <ng-container *ngIf="isEditMode; else em">
          <input [(ngModel)]="editEmployeeData.email">
        </ng-container>
        <ng-template #em><p>{{ emp.email }}</p></ng-template>
      </div>


      <!-- TEL -->
      <div>
        <label>T√©l√©phone</label>
        <ng-container *ngIf="isEditMode; else tel">
          <input [(ngModel)]="editEmployeeData.telephone">
        </ng-container>
        <ng-template #tel><p>{{ emp.telephone }}</p></ng-template>
      </div>


      <!-- SALAIRE -->
      <div>
        <label>Salaire</label>
        <ng-container *ngIf="isEditMode; else sal">
          <input type="number"
                 [(ngModel)]="editEmployeeData.salaire">
        </ng-container>
        <ng-template #sal><p>{{ emp.salaire }}</p></ng-template>
      </div>


      <!-- SEXE -->
      <div>
        <label>Sexe</label>
        <ng-container *ngIf="isEditMode; else sx">
          <input [(ngModel)]="editEmployeeData.sexe">
        </ng-container>
        <ng-template #sx><p>{{ emp.sexe }}</p></ng-template>
      </div>


      <!-- ADRESSE -->
      <div>
        <label>Adresse</label>
        <ng-container *ngIf="isEditMode; else adr">
          <input [(ngModel)]="editEmployeeData.adresse">
        </ng-container>
        <ng-template #adr><p>{{ emp.adresse }}</p></ng-template>
      </div>


      <!-- DEPARTEMENT -->
      <div>
        <label>D√©partement</label>

        <ng-container *ngIf="isEditMode; else dep">

          <select [(ngModel)]="selectedDepartementId"
                  (ngModelChange)="editEmployeeData.departement && (editEmployeeData.departement.id = $event)">

            <option value="">-- Choisir un d√©partement --</option>

            <option *ngFor="let d of departements"
                    [value]="d.id">
              {{ d.name }}
            </option>

          </select>

        </ng-container>

        <ng-template #dep>
          <p>{{ emp.departement?.name || 'Non assign√©' }}</p>
        </ng-template>
      </div>


      <!-- POSTE -->
      <div>
        <label>Poste</label>

        <ng-container *ngIf="isEditMode; else pst">

          <select [(ngModel)]="selectedPosteId"
                  (ngModelChange)="editEmployeeData.poste && (editEmployeeData.poste.id = $event)">

            <option value="">-- Choisir un poste --</option>

            <option *ngFor="let p of postes"
                    [value]="p.id">
              {{ p.titre }}
            </option>

          </select>

        </ng-container>

        <ng-template #pst>
          <p>{{ emp.poste?.titre || 'Non assign√©' }}</p>
        </ng-template>
      </div>


    </div>


    <!-- ACTIONS -->
    <div class="detail-actions-edit"
         [hidden]="!isEditMode">

      <button class="save"
              (click)="saveUpdate(); $event.stopPropagation();">
        üíæ Enregistrer
      </button>

      <button class="cancel"
              (click)="cancelEdit()">
        ‚ùå Annuler
      </button>

    </div>

  </div>

</div>


<!-- =======================
     ADD / EDIT MODAL
======================= -->
<div class="modal-bg" *ngIf="showModal">

  <div class="modal">

    <h2>{{ isEditMode ? 'Modifier un employ√©' : 'Ajouter un employ√©' }}</h2>

    <div class="steps">
      <div [class.active]="step === 1">1. Identit√©</div>
      <div [class.active]="step === 2">2. Pro</div>
    </div>


    <!-- STEP 1 -->
    <div *ngIf="step === 1">

      <input [(ngModel)]="newEmployee.firstName" placeholder="Pr√©nom">
      <input [(ngModel)]="newEmployee.lastName" placeholder="Nom">
      <input [(ngModel)]="newEmployee.email" placeholder="Email">
      <input [(ngModel)]="newEmployee.telephone" placeholder="T√©l√©phone">
      <input [(ngModel)]="newEmployee.adresse" placeholder="Adresse">

      <select [(ngModel)]="newEmployee.sexe">
        <option value="">Sexe</option>
        <option value="Homme">Homme</option>
        <option value="Femme">Femme</option>
      </select>

      <label>Date de naissance</label>
      <input type="date"
             [(ngModel)]="newEmployee.dateNaissance">

    </div>


    <!-- STEP 2 -->
    <div *ngIf="step === 2">

      <label>Date d‚Äôembauche</label>
      <input type="date"
             [(ngModel)]="newEmployee.dateEmbauche">

      <input type="number"
             [(ngModel)]="newEmployee.salaire"
             placeholder="Salaire">


      <select [(ngModel)]="newEmployee.poste.id">
        <option value="">-- Choisir un poste --</option>

        <option *ngFor="let p of postes"
                [value]="p.id">
          {{ p.titre }}
        </option>
      </select>


      <select [(ngModel)]="newEmployee.departement.id">
        <option value="">-- Choisir un d√©partement --</option>

        <option *ngFor="let d of departements"
                [value]="d.id">
          {{ d.name }}
        </option>
      </select>

    </div>


    <!-- ACTIONS -->
    <div class="modal-actions">

      <button *ngIf="step > 1"
              class="cancel"
              (click)="prevStep()">
        ‚óÄ Pr√©c√©dent
      </button>

      <button *ngIf="step < 2"
              class="save"
              (click)="nextStep()">
        Suivant ‚ñ∂
      </button>

      <button type="button"
              *ngIf="step === 2"
              class="save"
              (click)="saveEmployee()"
              >
        üíæ Enregistrer
      </button>

      <button class="cancel"
              (click)="closeModal()">
        ‚ùå Annuler
      </button>

    </div>

  </div>

</div>
